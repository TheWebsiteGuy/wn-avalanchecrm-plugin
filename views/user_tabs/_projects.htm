<?php 
use Backend\Facades\Backend;
$client = $formModel->client; 
?>
<?php if ($client): ?>
<?php $projects = $client->projects()->orderBy('created_at', 'desc')->get(); ?>
<div class="control-list mt-3">
    <table class="table data">
        <thead>
            <tr>
                <th><span>Name</span></th>
                <th><span>Status</span></th>
                <th><span>Start Date</span></th>
                <th style="width: 50px"></th>
            </tr>
        </thead>
        <tbody>
            <?php if ($projects->count() > 0): ?>
            <?php foreach ($projects as $project): ?>
            <tr>
                <td>
                    <?= e($project->name) ?>
                </td>
                <td>
                    <span class="badge badge-info">
                        <?= e(ucfirst($project->status)) ?>
                    </span>
                </td>
                <td>
                    <?= $project->start_date ? (new \DateTime($project->start_date))->format('M d, Y') : '' ?>
                </td>
                <td>
                    <a href="<?= Backend::url('thewebsiteguy/avalanchecrm/projects/update/' . $project->id) ?>"
                        class="btn btn-xs btn-secondary">
                        <i class="icon-pencil"></i>
                    </a>
                </td>
            </tr>
            <?php endforeach; ?>
            <?php else: ?>
            <tr>
                <td colspan="4" class="nolist">No projects found for this client.</td>
            </tr>
            <?php endif; ?>
        </tbody>
    </table>
</div>
<?php else: ?>
<p>No client profile associated with this user.</p>
<?php endif; ?>