<?php Block::put('breadcrumb') ?>
    <ul>
        <li><a href="<?= Backend::url('thewebsiteguy/avalanchecrm/dashboard') ?>">Avalanche CRM</a></li>
        <li class="active">Email Templates</li>
    </ul>
<?php Block::endPut() ?>

<?php
    $baseUrl = Backend::url('thewebsiteguy/avalanchecrm/emailtemplates');
    $createUrl = Backend::url('thewebsiteguy/avalanchecrm/emailtemplates/create');
?>

<!-- Category Cards -->
<div class="padded-container" style="padding-top: 20px;">
    <div class="template-category-grid">
        <?php foreach ($categories as $key => $cat): ?>
        <div class="template-category-card" style="border-top-color: <?= $cat['color'] ?>;">
            <div class="tpl-card-header">
                <div class="tpl-card-icon" style="background-color: <?= $cat['color'] ?>15; color: <?= $cat['color'] ?>;">
                    <i class="<?= $cat['icon'] ?>"></i>
                </div>
                <div class="tpl-card-title">
                    <h4><?= e($cat['label']) ?></h4>
                    <span class="tpl-card-count"><?= $cat['count'] ?> template<?= $cat['count'] !== 1 ? 's' : '' ?></span>
                </div>
            </div>
            <div class="tpl-card-body">
                <p><?= e($cat['description']) ?></p>
                <?php if (!empty($cat['templates'])): ?>
                <ul class="tpl-template-list">
                    <?php foreach ($cat['templates'] as $tpl): ?>
                    <li>
                        <a href="<?= $baseUrl ?>/update/<?= $tpl->id ?>">
                            <span class="tpl-name"><?= e($tpl->name) ?></span>
                            <?php if ($tpl->is_active): ?>
                                <span class="tpl-badge tpl-badge-active">Active</span>
                            <?php else: ?>
                                <span class="tpl-badge tpl-badge-inactive">Inactive</span>
                            <?php endif; ?>
                        </a>
                    </li>
                    <?php endforeach; ?>
                </ul>
                <?php else: ?>
                <p class="tpl-empty">No templates in this category yet.</p>
                <?php endif; ?>
            </div>
            <div class="tpl-card-footer">
                <a href="<?= $baseUrl ?>?category=<?= $key ?>" class="btn btn-sm btn-default">
                    <i class="icon-list"></i> View All
                </a>
                <a href="<?= $createUrl ?>?category=<?= $key ?>" class="btn btn-sm btn-primary">
                    <i class="icon-plus"></i> New Template
                </a>
            </div>
        </div>
        <?php endforeach; ?>
    </div>
</div>

<!-- Full Template List Below -->
<div class="padded-container" style="padding-top: 10px;">
    <h4 style="margin-bottom: 15px;">All Templates</h4>
    <?= $this->listRender() ?>
</div>

<style>
    .template-category-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
        gap: 20px;
        margin-bottom: 25px;
    }

    .template-category-card {
        background: #fff;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        border-top: 4px solid #ddd;
        display: flex;
        flex-direction: column;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .template-category-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    }

    .tpl-card-header {
        padding: 20px 20px 15px;
        display: flex;
        align-items: center;
        gap: 14px;
        border-bottom: 1px solid #f0f0f0;
    }

    .tpl-card-icon {
        width: 44px;
        height: 44px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        flex-shrink: 0;
    }

    .tpl-card-title h4 {
        margin: 0 0 2px;
        font-size: 15px;
        font-weight: 600;
        color: #333;
    }

    .tpl-card-count {
        font-size: 12px;
        color: #999;
    }

    .tpl-card-body {
        padding: 15px 20px;
        flex-grow: 1;
    }

    .tpl-card-body > p:first-child {
        font-size: 13px;
        color: #777;
        margin: 0 0 12px;
        line-height: 1.4;
    }

    .tpl-template-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .tpl-template-list li {
        border-bottom: 1px solid #f5f5f5;
    }

    .tpl-template-list li:last-child {
        border-bottom: none;
    }

    .tpl-template-list li a {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 4px;
        color: #444;
        text-decoration: none;
        font-size: 13px;
        transition: background 0.15s;
        border-radius: 3px;
    }

    .tpl-template-list li a:hover {
        background: #f8f9fb;
        color: #1a73e8;
        text-decoration: none;
    }

    .tpl-name {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .tpl-badge {
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 10px;
        font-weight: 500;
        flex-shrink: 0;
        margin-left: 8px;
    }

    .tpl-badge-active {
        background: #e8f5e9;
        color: #2e7d32;
    }

    .tpl-badge-inactive {
        background: #fce4ec;
        color: #c62828;
    }

    .tpl-empty {
        font-size: 13px;
        color: #bbb;
        font-style: italic;
        margin: 0;
    }

    .tpl-card-footer {
        padding: 12px 20px;
        border-top: 1px solid #f0f0f0;
        display: flex;
        gap: 8px;
    }
</style>
